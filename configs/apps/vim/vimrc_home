filetype off

call pathogen#infect('~/.vim/bundle/{}')
call pathogen#helptags()
call pathogen#incubate()

filetype plugin indent on
syntax on

set number
set hlsearch

colorscheme desert

nmap <C-Right> :tabnext<CR>
nmap <C-Left> :tabprev<CR>
nmap gn :tabnew<CR>
" nmap <C-x> :quit<CR>

"nmap <C-W><Left> :vertical resize -5<cr>
"nmap <C-W><Down> :resize -5<cr>
"nmap <C-W><Up> :resize +5<cr>
"nmap <C-W><Right> :vertical resize +5<cr>

function! s:ExecuteInShell(command)
	let command = join(map(split(a:command), 'expand(v:val)'))
	let winnr = bufwinnr('^' . command . '$')
	silent! execute  winnr < 0 ? 'botright new ' . fnameescape(command) : winnr . 'wincmd w'
	setlocal buftype=nowrite bufhidden=wipe nobuflisted noswapfile nowrap number
	echo 'Execute ' . command . '...'
	silent! execute 'silent %!'. command
	silent! execute 'resize ' . line('$')
	silent! redraw
	silent! execute 'au BufUnload <buffer> execute bufwinnr(' . bufnr('#') . ') . ''wincmd w'''
	silent! execute 'nnoremap <silent> <buffer> <LocalLeader>r :call <SID>ExecuteInShell(''' . command . ''')<CR>'
	echo 'Shell command ' . command . ' executed.'
endfunction

command! -complete=shellcmd -nargs=+ Shell call s:ExecuteInShell(<q-args>)

set title
"set switchbuf=newtab
"set shiftwidth=4 softtabstop=4 expandtab

"#################### Taglist ####################
nnoremap <Leader>tl :TlistToggle<CR>
let Tlist_Show_One_File = 1
let Tlist_Use_Right_Window = 1

"#################### NERDTree ####################
nmap <Leader>fl :NERDTreeTabsOpen<CR>
"################### AsyncCommand ################
nmap <Leader>ash :AsyncShell
nmap <Leader>agr :AsyncGrep
nmap <Leader>amk :AsyncMake


" VIM backup settings
set noswapfile

" Mutt
" au !BufRead /tmp/mutt* source ~/.mutt/address-search.vim

" fugitive git bindings
nnoremap <Leader>ga :Git add %:p<CR><CR>
nnoremap <Leader>gs :Gstatus<CR>
nnoremap <Leader>gc :Gcommit -v -q<CR>
nnoremap <Leader>gt :Gcommit -v -q %:p<CR>
nnoremap <Leader>gd :Gdiff<CR>
nnoremap <Leader>ge :Gedit<CR>
nnoremap <Leader>gr :Gread<CR>
nnoremap <Leader>gw :Gwrite<CR><CR>
nnoremap <Leader>gl :silent! Glog<CR>:bot copen<CR>
nnoremap <Leader>gp :Ggrep<Space>
nnoremap <Leader>gm :Gmove<Space>
nnoremap <Leader>gb :Git branch<Space>
nnoremap <Leader>go :Git checkout<Space>
nnoremap <Leader>gps :Dispatch! git push<CR>
nnoremap <Leader>gpl :Dispatch! git pull<CR>
